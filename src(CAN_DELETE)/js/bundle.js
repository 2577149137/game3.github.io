"use strict";(()=>{var t=Object.defineProperty,e=Object.getOwnPropertyDescriptor,o=(o,r,a,s)=>{for(var i,n=s>1?void 0:s?e(r,a):r,h=o.length-1;h>=0;h--)(i=o[h])&&(n=(s?i(r,a,n):i(n))||n);return s&&n&&t(r,a,n),n},{regClass:r,property:a}=Laya,s=class extends Laya.Script{constructor(){super(...arguments),this.normalSprite=null,this.pressedSprite=null,this.hoverSprite=null,this.disableSprite=null}onAwake(){this.owner instanceof Laya.Button?this.updateButtonState("normal"):console.error("ButtonSprite must be attached to a Button component")}onEnable(){this.owner.on(Laya.Event.MOUSE_DOWN,this,this.onButtonPress),this.owner.on(Laya.Event.MOUSE_UP,this,this.onButtonRelease),this.owner.on(Laya.Event.MOUSE_OVER,this,this.onButtonHover),this.owner.on(Laya.Event.MOUSE_OUT,this,this.onButtonNormal)}onDisable(){this.owner.off(Laya.Event.MOUSE_DOWN,this,this.onButtonPress),this.owner.off(Laya.Event.MOUSE_UP,this,this.onButtonRelease),this.owner.off(Laya.Event.MOUSE_OVER,this,this.onButtonHover),this.owner.off(Laya.Event.MOUSE_OUT,this,this.onButtonNormal)}onButtonPress(){this.updateButtonState("pressed")}onButtonRelease(){-1!==this.owner.mouseX&&-1!==this.owner.mouseY?this.updateButtonState("hover"):this.updateButtonState("normal")}onButtonHover(){this.updateButtonState("hover")}onButtonNormal(){this.updateButtonState("normal")}updateButtonState(t){if(this.owner)switch(t){case"normal":this.normalSprite&&(this.owner.skin=this.normalSprite.url);break;case"pressed":this.pressedSprite&&(this.owner.skin=this.pressedSprite.url);break;case"hover":this.hoverSprite&&(this.owner.skin=this.hoverSprite.url);break;case"disabled":this.disableSprite&&(this.owner.skin=this.disableSprite.url)}}set enabled(t){this.owner.mouseEnabled=t,this.updateButtonState(t?"normal":"disabled")}get enabled(){return this.owner.mouseEnabled}};o([a({type:Laya.Texture2D})],s.prototype,"normalSprite",2),o([a({type:Laya.Texture2D})],s.prototype,"pressedSprite",2),o([a({type:Laya.Texture2D})],s.prototype,"hoverSprite",2),o([a({type:Laya.Texture2D})],s.prototype,"disableSprite",2),s=o([r("bs0Yem5IRcWVN9UJ5QXHug")],s);var{regClass:i,property:n}=Laya,h=class extends Laya.Script{onStart(){this.owner.color=this.getRandomColor();const{x:t,y:e}=this.randomPos();this.owner.pos(t,e)}getRandomColor(){const t=t=>{const e=t.toString(16);return 1===e.length?"0"+e:e};return`#${t(Math.floor(256*Math.random()))}${t(Math.floor(256*Math.random()))}${t(Math.floor(256*Math.random()))}`.toUpperCase()}randomPos(){const t=Laya.stage.designWidth,e=Laya.stage.designHeight;return{x:Math.random()*(t-300)+150,y:Math.random()*(e-300)+150}}};h=o([i("xX7jcHQaSSOUAx-ynM5QIQ")],h);var{regClass:y,property:d}=Laya,l=class extends Laya.Script{constructor(){super(...arguments),this.nodeDotBg=null,this.nodeDot=null,this.maxLength=0,this.dragging=!1,this._dir=new Laya.Vector3(0,0,0),this.roleAngle=0}get dir(){return this._dir}set dir(t){this._dir=t}onAwake(){null==l.ins&&(l.ins=this),this.init()}init(){this.maxLength=this.nodeDotBg.width/2,this.nodeDotBg.on(Laya.Event.MOUSE_DOWN,this,t=>{this.dragging=!0,this.onTouchMove(t)}),this.owner.on(Laya.Event.MOUSE_MOVE,this,this.onTouchMove),this.owner.on(Laya.Event.MOUSE_UP,this,t=>{this.dragging=!1,this.onTouchEnd(t)})}onTouchMove(t){if(!this.dragging)return;const e=this.nodeDotBg.globalToLocal(new Laya.Point(t.stageX,t.stageY),!0),o=new Laya.Point(e.x-this.nodeDotBg.width/2,e.y-this.nodeDotBg.height/2),r=Math.sqrt(o.x*o.x+o.y*o.y);r>0&&(this._dir.x=o.x/r,this._dir.y=o.y/r,r>this.maxLength&&(o.x=this.maxLength*this._dir.x,o.y=this.maxLength*this._dir.y),this.nodeDot.pos(o.x+this.nodeDotBg.width/2-this.nodeDot.width/2,o.y+this.nodeDotBg.height/2-this.nodeDot.height/2))}onTouchEnd(t){this._dir=new Laya.Vector3(0,0,0),this.nodeDot.pos(this.nodeDotBg.width/2-this.nodeDot.width/2,this.nodeDotBg.height/2-this.nodeDot.height/2)}calculateAngle(){if(0===this._dir.x&&0===this._dir.y)return this.roleAngle;const t=Math.atan2(this._dir.y,this._dir.x);return this.roleAngle=180*t/Math.PI,this.roleAngle}};l.ins=null,o([d({type:Laya.Sprite,tips:"摇杆背景节点"})],l.prototype,"nodeDotBg",2),o([d({type:Laya.Sprite,tips:"摇杆中间点节点"})],l.prototype,"nodeDot",2),l=o([y("QtfqoqUXS7iky2CFKqCPDA")],l);var{regClass:p,property:u}=Laya,c=class extends Laya.Script{constructor(){super(...arguments),this.bodyPrefab=null,this.foodPrefab=null,this.joystick=null,this.txt_Score=null,this.startPanel=null,this.gameOverPanel=null,this.btn_Start=null,this.btn_Restart=null,this.bodyArray=[],this.bodyNum=2,this.bodyDistance=50,this.snakeDir=new Laya.Vector3(0,0,0),this.Score=0,this.speed=200,this.previousMoveDir=null}onAdded(){}onAwake(){Laya.SoundManager.musicVolume=.1,Laya.SoundManager.playMusic("resources/audios/BGM.wav",0);const t=new Laya.Vector2(0,0);Laya.Vector2.normalize(new Laya.Vector2(this.owner.x,this.owner.y),t),this.previousMoveDir=new Laya.Vector3(t.x,t.y,0),this.bodyArray.push(this.owner),this.rotateHead(new Laya.Vector2(this.owner.x,this.owner.y));for(let t=0;t<this.bodyNum;t++)this.getNewBody();const{x:e,y:o}=this.randomPos();this.owner.pos(e,o),this.btn_Start.on(Laya.Event.CLICK,this,this.startGame),this.btn_Restart.on(Laya.Event.CLICK,this,this.restartGame)}onStart(){Laya.timer.pause(),Laya.timer.loop(200,this,()=>{this.moveBody()}),this.owner.parent.addChild(this.foodPrefab.create())}onUpdate(){const t=Laya.timer.delta/1e3;this.snakeDir=this.joystick.getComponent(l).dir,0===this.snakeDir.length()?this.snakeDir=this.previousMoveDir:(this.owner.rotation=this.joystick.getComponent(l).calculateAngle()+90,this.previousMoveDir=this.snakeDir);const e=new Laya.Vector2(this.owner.x+this.snakeDir.x*this.speed*t,this.owner.y+this.snakeDir.y*this.speed*t);this.owner.pos(e.x,e.y)}randomPos(){const t=Laya.stage.designWidth,e=Laya.stage.designHeight;return{x:Math.random()*(t-600)+300,y:Math.random()*(e-600)+300}}getNewBody(){const t=this.bodyPrefab.create();if(this.bodyArray.length<3){const e=new Laya.Vector2(this.owner.x,this.owner.y);Laya.Vector2.normalize(e,e),Laya.Vector2.scale(e,this.bodyDistance,e),t.pos(this.owner.x+e.x,this.owner.y+e.y),t.name="Body"+(this.bodyArray.length-1)}else{const e=this.bodyArray[this.bodyArray.length-1],o=this.bodyArray[this.bodyArray.length-1];let r=new Laya.Vector2(o.x-o.x,o.y-e.y);Laya.Vector2.normalize(r,r),Laya.Vector2.scale(r,this.bodyDistance,r),t.pos(e.x+r.x,e.y+r.y)}this.owner.parent.addChild(t),this.bodyArray.push(t),this.changeZIndex()}rotateHead(t){const e=new Laya.Vector2(1,0),o=180*this.getSignedAngle(e,t)/Math.PI+90;this.owner.rotation=o}moveBody(){for(let t=this.bodyArray.length-2;t>=0;t--)this.bodyArray[t+1].pos(this.bodyArray[t].x,this.bodyArray[t].y);this.bodyArray[1].pos(this.owner.x,this.owner.y)}getSignedAngle(t,e){const o=t.x*e.x+t.y*e.y,r=t.x*e.y-t.y*e.x;return Math.atan2(r,o)}changeZIndex(){const t=this.owner.parent.numChildren-1;for(let e=0;e<this.bodyArray.length;e++)this.bodyArray[e].parent.setChildIndex(this.bodyArray[e],t-e)}startGame(){Laya.timer.resume(),this.startPanel.visible=!1}restartGame(){Laya.timer.resume(),Laya.Scene.open("Scene.ls")}onTriggerEnter(t,e,o){if("Food"===t.owner.name){t.owner.removeSelf(),this.Score++,this.txt_Score.text=`[color=#000000]${this.Score}[/color]`;const e=this.foodPrefab.create();this.owner.parent.addChild(e),this.getNewBody(),Laya.SoundManager.playSound("resources/audios/Eat.wav",1)}else(t.owner.name.startsWith("Wall")||"Body"===t.owner.name)&&(this.gameOverPanel.visible=!0,this.gameOverPanel.getChildByName("Txt_Score").text=`得分: ${this.Score}`,Laya.SoundManager.playSound("resources/audios/Die.wav",1),Laya.timer.pause())}};o([u(Laya.Prefab)],c.prototype,"bodyPrefab",2),o([u(Laya.Prefab)],c.prototype,"foodPrefab",2),o([u(Laya.Sprite)],c.prototype,"joystick",2),o([u(Laya.Text)],c.prototype,"txt_Score",2),o([u(Laya.Sprite)],c.prototype,"startPanel",2),o([u(Laya.Sprite)],c.prototype,"gameOverPanel",2),o([u(Laya.Button)],c.prototype,"btn_Start",2),o([u(Laya.Button)],c.prototype,"btn_Restart",2),o([u(Array(Laya.Node))],c.prototype,"bodyArray",2),o([u(Number)],c.prototype,"bodyNum",2),o([u(Number)],c.prototype,"bodyDistance",2),o([u(Laya.Vector3)],c.prototype,"snakeDir",2),o([u(Number)],c.prototype,"Score",2),c=o([p("-hBMMXtoTkCIMdHwIAErzA")],c);var{regClass:g,property:L}=Laya,w=class extends Laya.Script{constructor(){super(...arguments),this.index=0}onAwake(){this.owner.zOrder=this.index}};o([L(Number)],w.prototype,"index",2),w=o([g("J2aOOFMaTDeHkTAcQ4_SJQ")],w)})();