!function(t){"use strict";class e{}e.MAX_CODELINE=Number.MAX_VALUE,e.NULL_NODE=-100,e.VERSION=1,e.EXT="bp",e.TYPE="blueprint",e.configPath="internal/blueprint.bin";const n={},i={};class a{constructor(){this.map=new Map,this.callFunMap=new Map}getCallFun(t){return this.callFunMap.get(t)}setCallFun(t,e){this.callFunMap.set(t,e)}getParamsArray(t){let e=this.map.get(t);return e||(e=[],this.map.set(t,e)),e}}class s{constructor(){this.valueMap=new Map}copyValue(t,e){let n=this.valueMap.get(t);null!=n&&this.valueMap.set(e,n)}initValue(t){this.value=t,this.getValue=this.getValueOnly}setValue(t,e){this.valueMap.set(t,e)}getValueOnly(t){return this.value}getValue(t){return this.valueMap.get(t)}}var r,u,o,l;t.EPinDirection=void 0,(r=t.EPinDirection||(t.EPinDirection={}))[r.Input=0]="Input",r[r.Output=1]="Output",r[r.All=2]="All",t.EBlueNodeType=void 0,(u=t.EBlueNodeType||(t.EBlueNodeType={})).Unknow="unkown",u.Event="event",u.Fun="fun",u.Pure="pure",u.GetVariable="var",u.SetVarialbe="setVar",u.Branch="branch",u.Sequnece="sequnece",t.EPinType=void 0,(o=t.EPinType||(t.EPinType={}))[o.Exec=0]="Exec",o[o.BPFun=1]="BPFun",o[o.Other=2]="Other",t.BPType=void 0,(l=t.BPType||(t.BPType={})).Event="event",l.Function="function",l.BPEvent="bpEvent",l.Pure="pure",l.Class="class",l.Operator="operator",l.GetValue="getvalue",l.SetValue="setvalue",l.GetTmpValue="getTmpValue",l.SetTmpValue="setTmpValue",l.Branch="branch",l.Block="Block",l.Sequence="sequence",l.NewTarget="newtarget",l.CustomFun="customFun",l.CustomFunStart="customFunStart",l.CustomFunReturn="customFunReturn",l.Expression="expression",l.Assertion="Assertion";const p=[{name:"static_get",menuPath:"none",type:t.BPType.GetValue,modifiers:{isStatic:!0},properties:[{name:"target",type:"class"}],output:[{type:"any"}]},{name:"get_self",caption:"GetSelf",bpType:"prop",type:t.BPType.GetValue,isSelf:!0,modifiers:{isStatic:!0,isReadonly:!0},properties:[],output:[{name:"self",type:"any"}]},{id:"_$bpOnSet",name:"onPropertyChanged_EM",type:"event",bpType:"function",menuPath:"none",modifiers:{isPublic:!0},properties:[],output:[{name:"then",type:"exec"}]},{name:"static_set",menuPath:"none",type:t.BPType.SetValue,modifiers:{isStatic:!0},properties:[{name:"execute",type:"exec"},{name:"target",type:"class"},{name:"set",type:"any"}],output:[{name:"then",type:"exec"},{name:"return",type:"any"}]},{name:"tmp_get",menuPath:"none",type:t.BPType.GetTmpValue,properties:[],output:[{type:"any"}]},{name:"get",menuPath:"none",type:t.BPType.GetValue,properties:[{name:"target",type:"any"}],output:[{type:"any"}]},{name:"set",menuPath:"none",type:t.BPType.SetValue,properties:[{name:"execute",type:"exec"},{name:"target",type:"any"},{name:"set",type:"any"}],output:[{name:"then",type:"exec"},{name:"return",type:"any"}]},{name:"tmp_set",menuPath:"none",type:t.BPType.SetTmpValue,properties:[{name:"execute",type:"exec"},{name:"set",type:"any"}],output:[{name:"then",type:"exec"},{name:"return",type:"any"}]},{name:"branch",type:t.BPType.Branch,menuPath:"system",modifiers:{isStatic:!0},properties:[{name:"execute",type:"exec"},{name:"condition",type:"boolean"}],output:[{name:"true",type:"exec"},{name:"false",type:"exec"}]},{name:"sequence",type:t.BPType.Sequence,menuPath:"system",modifiers:{isStatic:!0},properties:[{name:"execute",type:"exec"}],output:[{name:"then0",type:"exec"},{name:"then1",type:"exec"}]},{name:"event_event",menuPath:"none",type:t.BPType.Event,properties:[],output:[{name:"",type:"bpFun"},{name:"then",type:"exec"}]},{name:"event_on",menuPath:"none",type:t.BPType.Function,properties:[{name:"",type:"bpFun"}]},{name:"event_off",menuPath:"none",type:t.BPType.Function,properties:[{name:"",type:"bpFun"}]},{name:"event_offAll",menuPath:"none",type:t.BPType.Function,properties:[]},{name:"event_call",menuPath:"none",type:t.BPType.Function,properties:[]},{name:"custom_fun_start",menuPath:"none",type:t.BPType.CustomFunStart,properties:[],output:[{name:"then",type:"exec"}]},{name:"custom_fun_return",menuPath:"none",type:t.BPType.CustomFunReturn,properties:[{name:"execute",type:"exec"}]},{name:"custom_static_fun",menuPath:"none",type:t.BPType.CustomFun,properties:[{name:"execute",type:"exec"}],output:[{name:"then",type:"exec"}]},{name:"custom_fun",menuPath:"none",type:t.BPType.CustomFun,properties:[{name:"execute",type:"exec"},{name:"target",type:"object"}],output:[{name:"then",type:"exec"}]},{name:"expression",menuPath:"system",type:t.BPType.Pure,modifiers:{isStatic:!0},properties:[{name:"caller",type:"any"},{name:"str",type:"string"}],output:[{type:"any"}]},{name:"as",menuPath:"system",type:t.BPType.Assertion,modifiers:{isStatic:!0},typeParameters:{T:{}},properties:[{name:"target",type:"any"},{name:"type",type:"new()=>T"}],output:[{name:"then",type:"T"}]},{name:"instanceof",menuPath:"system",type:t.BPType.Branch,modifiers:{isStatic:!0},properties:[{name:"execute",type:"exec"},{name:"target",type:"any"},{name:"type",type:"new()=>T"}],output:[{name:"true",type:"exec"},{name:"false",type:"exec"}]},{name:"equal",type:t.BPType.Pure,menuPath:"system",modifiers:{isStatic:!0},properties:[{name:"a",type:"any"},{name:"b",type:"any"}],output:[{name:"result",type:"boolean"}]},{name:"isNull",type:t.BPType.Pure,menuPath:"system",modifiers:{isStatic:!0},properties:[{name:"obj",type:"any"}],output:[{name:"result",type:"boolean"}]},{name:"toString",type:t.BPType.Pure,menuPath:"system",modifiers:{isStatic:!0},properties:[{name:"obj",type:"any"}],output:[{name:"result",type:"string"}]},{name:"toNumber",type:t.BPType.Pure,menuPath:"system",modifiers:{isStatic:!0},properties:[{name:"obj",type:"any"}],output:[{name:"result",type:"number"}]},{name:"toBoolean",type:t.BPType.Pure,menuPath:"system",modifiers:{isStatic:!0},properties:[{name:"obj",type:"any"}],output:[{name:"result",type:"boolean"}]},{name:"forEach",type:t.BPType.Block,menuPath:"system",modifiers:{isStatic:!0},properties:[{name:"execute",type:"exec"},{name:"array",type:"array"}],output:[{name:"loopBody",type:"exec"},{name:"element",type:"any"},{name:"index",type:"number"},{name:"completed",type:"exec"}]},{name:"forEachWithBreak",type:t.BPType.Block,menuPath:"system",modifiers:{isStatic:!0},properties:[{name:"execute",type:"exec"},{name:"array",type:"array"},{name:"break",type:"exec"}],output:[{name:"loopBody",type:"exec"},{name:"element",type:"any"},{name:"index",type:"number"},{name:"completed",type:"exec"}]},{name:"forLoop",type:t.BPType.Block,menuPath:"system",modifiers:{isStatic:!0},properties:[{name:"execute",type:"exec"},{name:"firstIndex",type:"number"},{name:"lastIndex",type:"number"},{name:"step",type:"number"}],output:[{name:"loopBody",type:"exec"},{name:"index",type:"number"},{name:"completed",type:"exec"}]},{name:"forLoopWithBreak",type:t.BPType.Block,menuPath:"system",modifiers:{isStatic:!0},properties:[{name:"execute",type:"exec"},{name:"firstIndex",type:"number"},{name:"lastIndex",type:"number"},{name:"step",type:"number"},{name:"break",type:"exec"}],output:[{name:"loopBody",type:"exec"},{name:"index",type:"number"},{name:"completed",type:"exec"}]}];var c;const h="-1",d="-2";class m{static formatName(t){let e=t.name;return t.dotdotdot&&(e.startsWith("...")||(e="..."+e)),e}static formatType(t){if(t&&"string"==typeof t){if("array"==t)return["any"];let e=t.indexOf("<");if(0<e){let n=t.substring(0,e),i=t.substring(e+1,t.lastIndexOf(">"));if("Array"==n.trim())return[this.formatType(i)];if("Record"==n.trim())return["Record",this.formatType(i)]}if(e=t.indexOf("[]"),0<=e)return[t.substring(0,e)]}return t}constructor(e,n=null,i=null){this.constData={},this.autoCreateData={},this.isStartCatch=!0,this.isResetData=!1,this._extendsData=e,this._regFunction=n,this._getClass=i;let a=p;for(let e=a.length-1;e>=0;e--){let n=a[e];if(null==n)continue;null==n.id&&(n.id=n.name),null==n.bpType&&(n.bpType="function"),null==n.target&&(n.target="system"),null==this.constData[n.target]&&(this.constData[n.target]={data:{}}),this.constData[n.target].data[n.id]=n;let i=n.properties;if(i)for(let t=i.length-1;t>=0;t--){let e=i[t];e.type=c.formatType(e.type),null==e.name?e.name=String.fromCharCode(97+t):"execute"==e.name&&"exec"==e.type&&null==e.id?(e.id=h,e.caption="execute",e.name=h):"target"==e.name&&null==e.id&&(e.caption="target",e.name=d,e.id=d)}t.BPType.Function==n.type&&(i?(null!=n.modifiers&&n.modifiers.isStatic||i.unshift(c.defTarget),i.unshift(c.defFunIn)):(i=[c.defFunIn],null!=n.modifiers&&n.modifiers.isStatic||i.push(c.defTarget),n.properties=i));let s=n.output;if(s)for(let t=s.length-1;t>=0;t--){let e=s[t];if(e.type=c.formatType(e.type),"then"==e.name&&"exec"==e.type&&null==e.id)e.id="out_-1";else if(null==e.name){if(0!=t)throw"output插槽必须要有name！";e.name="return"}}t.BPType.Function==n.type&&(s?s.unshift(c.defFunOut):(s=[c.defFunOut],n.output=s))}this.initData(e)}get extendsData(){return this._extendsData}getExtends(t,e){if(null==t)return null;null==e?e=[t]:e.push(t);let n=this._extendsData[t];return null!=n&&this.getExtends(n.extends,e),e}getConstDataById(t,e){if(null!=this.getConstDataExt){let n=this.getConstDataExt(t,e);if(null!=n)return n}let n=this.constData[t];return n?n.data[e]:null}_getConstData(t,e){if(null==t)return null;null==e&&(e="system");let n=this.constData[e];if(n){let i=n.data[t];return null==i&&"system"!=e?this._getConstData(t):i}return"system"!=e?this._getConstData(t):null}static clone(t){return null==t?t:JSON.parse(JSON.stringify(t))}_getConstByNode(e){if(null==e.dataId)return this._getConstData(e.cid,e.target);{let n=e.cid+"_"+e.dataId+"_"+e.target;if(this.isStartCatch&&null!=this.autoCreateData[n])return this.autoCreateData[n];let i=this._getConstData(e.cid,e.target);if("static_get"==e.cid||"static_set"==e.cid||"get"==e.cid||"set"==e.cid||"tmp_get"==e.cid||"tmp_set"==e.cid)return i;let a=null;if(null==a){let t=c.allDataMap.get(e.target);t&&(a=t[e.dataId])}if(null==a&&(a=this.getConstDataById(e.target,e.dataId)),a){i=c.clone(i),i._isClone=!0;let e=a.properties;if(t.BPType.CustomFunReturn!=i.type&&e)for(let n=0,a=e.length;n<a;n++)null!=e[n].name&&""!=e[n].name.trim()?t.BPType.Event==i.type||t.BPType.CustomFunStart==i.type?(null==i.output&&(i.output=[]),this._checkAndPush(i.output,e[n])):(null==i.properties&&(i.properties=[]),this._checkAndPush(i.properties,e[n])):null!=e[n].caption&&""!=e[n].caption.trim()&&console.log("数据异常，应该是属性面板增加了这个属性，但是没有自动创建数据的id号，出现原因不明，有可能是数据回退造成的，待查！");if(t.BPType.CustomFunStart!=i.type&&t.BPType.Event!=i.type&&"event_call"!=i.name){let e=a.output;if(e)for(let n=0,a=e.length;n<a;n++)null!=e[n].name&&""!=e[n].name.trim()&&(t.BPType.CustomFunReturn==i.type?(null==i.properties&&(i.properties=[]),this._checkAndPush(i.properties,e[n])):(null==i.output&&(i.output=[]),this._checkAndPush(i.output,e[n])))}return this.autoCreateData[n]=i,i}}return null}getConstNode(t){let e=this._getConstByNode(t);if(e&&t.properties||t.outputs){if(e._isClone||(e=c.clone(e),e._isClone=!0),t.properties){let n=e.properties.pop(),i=n.name.substring(3);for(let e=0,n=t.properties.length;e<n;e++){t.properties[e].caption=i+"_"+(e+1)}e.properties.push(...t.properties),e.properties.push(n)}if(t.outputs){let n=e.output.pop();e.output.push(...t.outputs),e.output.push(n)}}return e}_checkAndPush(t,e){for(let n=t.length-1;n>=0;n--)if(t[n].name==e.name)return;t.push(e)}_createExtData(t,e,n){this._getClass&&(n=this._getClass(e));let i=this.constData[e];if(null!=i)return i;let a=t[e];if(null==a){let a=this._extendsData[e];if(null!=a&&null!=a.extends){let s=this._createExtData(t,a.extends,n);i={data:Object.create(s.data)},i.extends=a.extends,this.constData[e]=i}else this.constData[e]={data:{}};return this.constData[e]}let s=a.extends;if(s){let r=this._createExtData(t,s,n);i={data:Object.create(r.data)},i.extends=s,this._createConstData(a,i,e,n)}else i={data:{}},this._createConstData(a,i,e,n);return a.name!=e&&(i.caption=a.name),null!=a.caption&&(i.caption=a.caption),this.constData[e]=i,i}_createConstData(e,n,i,a){if((null==e?void 0:e.props)&&e.props.forEach(t=>{t.id="var_"+t.name,null!=t.customId?t.id=t.customId:t.modifiers&&t.modifiers.isStatic&&(t.id+="_static"),t.const=!0,t.target=i,t.bpType="prop",n.data[t.id]=t}),!e||"Interface"!==e.type||e.funcs&&0!==e.funcs.length||(e.construct={params:e.props}),null==e?void 0:e.construct){let a={name:i,target:i,menuPath:"createNew",id:"construct_"+i,bpType:"construct",type:t.BPType.NewTarget,properties:[],output:[{name:"return",type:i}]};n.data[a.id]=a,e.construct.params&&(a.properties=e.construct.params.map(t=>({name:c.formatName(t),type:c.formatType(t.type)})));for(let t in e.construct)"params"!=t&&null==a[t]&&(a[t]=e.construct[t])}(null==e?void 0:e.events)&&e.events.forEach(t=>{null==t.id&&(t.id="event_"+t.name),null!=t.customId&&(t.id=t.customId),t.bpType="event",t.target=i,null==t.properties&&null!=t.params&&(t.properties=t.params),n.data[t.id]=t}),(null==e?void 0:e.funcs)&&e.funcs.forEach(e=>{let s=e.modifiers;if(s||(s=e.modifiers={}),null==s.isPublic||s.isPublic||s.isProtected){let r=c.createCData(e);if(r.target=i,this._regFunction&&a){let t=s.isStatic?a[e.name]:a.prototype[e.name];this._regFunction(r.id,t,!s.isStatic,a,r.target)}if(e.params&&e.params.length>0){let n=e.params;for(let t=n.length-1;t>=0;t--)n[t].name=c.formatName(n[t]);t.BPType.Event==r.type?r.output.push(...e.params):r.properties=[...e.params]}c.handleCDataTypes(r,e,i);for(let t in e)null==r[t]&&(r[t]=e[t]);n.data[r.id]=r,n.data[r.oldId]=r}});const s=this.constData.system;if(s&&s!==n)for(const t in s.data){const e=s.data[t];"event"===e.type&&"function"===e.bpType&&void 0!==e.modifiers&&(n.data[e.id]=Object.assign(Object.assign({},e),{target:i}))}}removeData(t){this.isResetData=!0,delete this.constData[t],delete this._extendsData[t]}resetData(t,e){this.isResetData=!0,null==t.caption&&(t.caption=t.name),t.name=e,delete this.constData[e],delete this._extendsData[e],this._extendsData[e]=t,this._createExtData({[e]:t},e,null)}initData(t){for(let e in t)delete this.constData[e];for(let e in t){const n=t[e];this._extendsData[e]=n;let i=null,a=!0;!n||"Interface"!==n.type||n.funcs&&0!==n.funcs.length||(a=!1),this._getClass&&a&&(i=this._getClass(e),!i)||this._createExtData(t,e,null)}}static handleCDataTypes(e,n,i){this.funlike.includes(e.type)&&(e.properties=e.properties||[],n.modifiers&&n.modifiers.isStatic||e.properties.unshift({name:d,caption:"target",type:i,id:d}),e.type==t.BPType.Pure?e.output.shift():e.properties.unshift(this.defFunIn),"void"!=n.returnType&&(n.returnType instanceof Array?e.output.push(...n.returnType):e.output.push({name:"return",type:n.returnType})))}static createCData(e){const n=e.params;let i="_";if(n)for(let t=0,e=n.length;t<e;t++){i+="_"+n[t].name}let a={bpType:"function",modifiers:e.modifiers,name:e.name,id:"fun_"+e.name+i,oldId:"fun_"+e.name,type:t.BPType.Function,output:[this.defEventOut],properties:[]};return null!=e.customId?(a.id=e.customId,a.oldId=e.customId):(a.id=e.modifiers.isStatic?a.id+"_static":a.id,a.oldId=e.modifiers.isStatic?a.oldId+"_static":a.oldId),a.menuPath=e.menuPath,a.type=c.checklike.includes(e.type)?e.type:a.type,a.type=e.customId?t.BPType.CustomFun:a.type,a.customId=e.customId||a.customId,a.typeParameters=e.typeParameters||a.typeParameters,a}static formatData(t,e,n,i){let a=t.blueprintArr,s={name:e,props:[],funcs:[],events:[],extends:t.extends};for(const t in a){let n=a[t];this._initTarget(n.arr,e)}if(t.variable){let e=s.props;t.variable.forEach(t=>{n&&(n[t.id]=t),i&&(i[t.id]=t);let a={name:t.name,tips:t.tips,caption:t.caption,type:t.type,customId:String(t.id),modifiers:t.modifiers,value:t.value};null==a.modifiers&&(a.modifiers={}),e.push(a)})}if(t.events&&t.events.forEach(t=>{n&&(n[t.id]=t),s.events.push(t)}),t.functions){let i=s.funcs;t.functions.forEach(t=>{n&&(n[t.id]=t),n&&t.variable&&t.variable.forEach(t=>{n[t.id]=t}),this._initTarget(t.arr,e);let a={name:t.name,tips:t.tips,type:"function",customId:t.id,caption:t.caption,params:[],modifiers:t.modifiers,returnType:"void"};null==a.modifiers&&(a.modifiers={});let s=t.properties;if(s){let t=a.params;for(let e=0,n=s.length;e<n;e++){let n=s[e],i={name:n.name,tips:n.tips,caption:n.caption,type:n.type,id:n.id};t.push(i)}}let r=t.output;if(r){let t=[];for(let e=0,n=r.length;e<n;e++){let n=r[e];t.push({name:n.name,tips:n.tips,caption:n.caption,type:n.type,id:n.id})}a.returnType=t}i.push(a)})}return s}static _initTarget(t,e){for(let n=t.length-1;n>=0;n--)null!=t[n].dataId&&null==t[n].target&&(t[n].target=e)}}c=m,m.allDataMap=new Map,m.defFunOut={name:"then",type:"exec",id:"out_-1"},m.defFunIn={name:h,caption:"execute",type:"exec",id:h},m.defTarget={name:d,caption:"target",type:"any",id:d},m.defEventOut=c.defFunOut,m.funlike=[t.BPType.Function,t.BPType.CustomFun,t.BPType.Pure],m.checklike=[t.BPType.Pure,t.BPType.Function,t.BPType.Event];class y{constructor(){this.pins=[]}addPin(t){this.pins.push(t)}parse(t){this.def=t,this.name=t.name,this.setType(t.type);let e=B.getFunction(t.id||t.name,t.target);this.setFunction(e?e[0]:null,!!e&&e[1]),t.properties&&this.addInput(t.properties),t.output&&this.addOutput(t.output)}getPropertyItem(t){const e=this.def.properties;for(let n=0,i=e.length;n<i;n++){const i=e[n];if(i.name==t||i.id==t)return i}return null}getValueType(t){let e=this.def.properties;for(let n=0,i=e.length;n<i;n++){let i=e[n];if(i.name==t||i.id==t){if(null==i.valueType){let t=i.type;if("string"==typeof t){if(0==t.indexOf("new()=>")||"class"==t||d==i.id)return"class";if(0==t.indexOf("resource:"))return"resource"}if(i.isAsset)return"resource"}return i.valueType}}return null}isEmptyObj(t){for(let e in t)return!1;return!0}_checkTarget(t){if(this.def.name&&0==this.def.name.indexOf("static_")&&(null==t.inputValue||null==t.inputValue[d]&&t.target)){let e=this.def.properties;if(e)for(let n=0,i=e.length;n<i;n++){let i=e[n];if(d==i.id)return null==t.inputValue&&(t.inputValue={}),void(t.inputValue[d]=t.target)}}}parseLinkData(t,e){if(this.onParseLinkData(t,e),this._checkTarget(t),t.inputValue)for(const e in t.inputValue){let n=this.getPinByName(e);if(n){if(0==n.linkTo.length){let i=t.inputValue&&t.inputValue[e];switch(this.getValueType(e)){case"class":n.value=E.getClass(i);break;case"resource":n.value=E.getResByUUID(i);break;default:let t=Laya.SerializeUtil.decodeObj(i);if(null==t){const n=this.getPropertyItem(e);if(n&&"string"==typeof n.type){const e=Laya.ClassUtils.getClass(n.type);e&&(t=Laya.SerializeUtil.decodeObj(i,new e))}null==t&&(t=i)}n.value=t}}}else console.error("not find pin "+e)}if(t.output)for(const n in t.output){let i=this.getPinByName(n);if(!i){console.error("not find pin "+n);continue}let a=t.output[n].infoArr;for(let t=0,s=a.length;t<s;t++){let s=a[t],r=e.getNodeById(s.nodeId);if(r){let t=r.getPinByName(s.id);if(!t){console.error("not find to pin "+n);continue}i.startLinkTo(t)}else console.error("can't find node ")}}}onParseLinkData(t,e){}setFunction(t,e){}setType(t){this.type=t}addInput(e){e.forEach(e=>{let n=this.createPin(e);n.direction=t.EPinDirection.Input,this.addPin(n),n.id=this.nid+"_"+(this.pins.length-1)})}addOutput(e){e.forEach(e=>{let n=this.createPin(e);n.direction=t.EPinDirection.Output,this.addPin(n),n.id=this.nid+"_"+(this.pins.length-1)})}getPinByName(t){return this.pins.find(e=>e.nid==t)}}class f{get direction(){return this._direction}set direction(e){e==t.EPinDirection.Input&&this.type==t.EPinType.BPFun&&(this.type=t.EPinType.Other),this._direction=e}constructor(){this.linkTo=[]}parse(e){switch(this.name=e.name,this.nid=e.id||e.name,this.otype=e.type,e.type){case"exec":this.type=t.EPinType.Exec;break;case"bpFun":this.type=t.EPinType.BPFun;break;default:this.type=t.EPinType.Other}}startLinkTo(t){this.linkTo.push(t),-1==t.linkTo.indexOf(this)&&t.linkTo.push(this)}}class g extends f{step(t,e,n,i,a){return this.owner.tryExecute(t,e,!1,n,!0,i,this,a)}execute(t,e,n,i){const a=this.linkTo[0];return null==a?void 0:a.owner.step(t,e,!0,n,!0,i,a,this)}getValueCode(){return"string"==typeof this.value?'"'+this.value+'"':this.value}}class P{static create(){return new P}wait(t){this._callback=t,this._completed&&t(this)}hasCallBack(){return null!=this._callback}complete(){this._completed=!0,this._callback&&this._callback(this)}recover(){this.clear()}clear(){this._callback=null,this._completed=!1,this.pin=null,this.nid=null,this.prePin=null}}class x extends y{constructor(){super(),this.inPutParmPins=x._EMPTY,this.outPutParmPins=x._EMPTY,this.tryExecute=this.step}addRef(){null==this._refNumber&&(this._refNumber=0),this._refNumber++}getRef(){return this._refNumber}emptyExecute(t,e,n,i,a,s,r){return null}createPin(t){let e=new g;return e.parse(t),e}executeFun(t,e,n,i,a,s,r){return t.executeFun(this.nativeFun,this.returnValue,e,i,a,s)}collectParam(t,e,n,i,a,s){let r=e.getDataById(this.nid).getParamsArray(a);r.length=0;for(let u=0,o=n.length;u<o;u++){const o=n[u];let l=o.linkTo[0];l?(t.readCache||l.step(t,e,i,a,s),t.parmFromOtherPin(o,e,l,r,a)):t.parmFromSelf(o,e,r,a)}return t.readCache=!1,r}_checkRun(t){let e;return t.forEach(t=>{t instanceof Promise&&(e||(e=[]),e.push(t))}),e?Promise.all(e):null}step(t,n,i,a,s,r,u,o){let l=this.collectParam(t,n,this.inPutParmPins,a,r,o);this.outPutParmPins.length>1&&(t.parmFromOutPut(this.outPutParmPins,n,l),t.parmFromCustom(l,r,"runId"));let p=this._checkRun(l);if(p){let e=P.create();return this.returnValue&&n.setPinData(this.returnValue,p,r),p.then(l=>{e.hasCallBack()?(e.nid=this.nid,e.pin=u,e.prePin=o,t.readCache=!0,e.complete()):(t.readCache=!0,this.step(t,n,i,a,s,r,u,o)),e.recover()}),e}const c=i&&t.beginExecute(this,a,s,u,l,o);if(c)return c;if(this.nativeFun){let i=null;if(this.isMember){let e=l.shift();i=void 0===e?t.getSelf():e}let p=this.executeFun(t,n,a,i,l,r,u);if(p instanceof Promise){let i=P.create();return p.then(p=>{this.returnValue&&n.setPinData(this.returnValue,p,r);let c=this.next(t,n,l,a,s,r,u);c&&(c=c.linkTo[0],i.nid=c?c.owner.nid:e.NULL_NODE),i.pin=c,i.prePin=o,i.complete(),i.recover()}),i}}return i&&t.endExecute(this),this.next(t,n,l,a,!0,r,u)}next(t,e,n,i,a,s,r){return null}addPin(e){if(e.owner=this,super.addPin(e),e.type==t.EPinType.Other)switch(e.direction){case t.EPinDirection.Input:this.inPutParmPins==x._EMPTY&&(this.inPutParmPins=[]),this.inPutParmPins.push(e);break;case t.EPinDirection.Output:this.outPutParmPins==x._EMPTY&&(this.outPutParmPins=[]),this.outPutParmPins.push(e),1==this.outPutParmPins.length?this.returnValue=e:this.returnValue=null}}optimize(){}setFunction(t,e){this.nativeFun=t,this.isMember=e,this.funcode=null==t?void 0:t.name}addNextPIn(){}}x._EMPTY=[];class b extends x{collectParam(t,e,n,i,a,s){let r=e.getDataById(this.nid).getParamsArray(a);r.length=0;for(let u=0,o=n.length;u<o;u++){const o=n[u];let l=o.linkTo[0];if(l){let n=l.owner;t.getCacheAble(n,a)||(l.step(t,e,i,a,s),t.setCacheAble(n,a,!0)),t.parmFromOtherPin(o,e,l,r,a)}else t.parmFromSelf(o,e,r,a)}return t.readCache=!1,r}}class B{static regBPClass(t,e){this._bpMap.set(t,e)}static regFunction(t,e,n=!1,i=null,a="system"){0==n&&i&&e&&(e=e.bind(i)),this._funMap.set(t+"_"+a,[e,n])}static getFunction(t,e){return this._funMap.get(t+"_"+e)}static regBPContextData(t,e){this._bpContextMap.set(t,e)}static getBPContextData(t){return this._bpContextMap.get(t)||a}static createCls(t,e){let n=(i=t,a=e,{[i]:class extends a{constructor(...t){var e;super(...t);let n=new B.BPExecuteCls(this);this[B.contextSymbol]=n,this._bp_data={};let i=this[B.bpSymbol].varMap;if(this[B.bpSymbol].isRunningInIDE&&(this.runInEditor=!0),i)for(let t in i){let a=i[t];if(!(null===(e=a.modifiers)||void 0===e?void 0:e.isStatic)){n.initVar(a.name,a.value);let t=this;Object.defineProperty(this._bp_data,a.name,{enumerable:!0,configurable:!1,get:function(){return n.getVar(a.name)},set:function(e){n.setVar(a.name,e),B.onPropertyChanged_EM(t)}})}}this._bp_init_()}onPropertyChanged_EM(){}_bp_init_(){let t=this[B.bpSymbol].mainBlock.autoAnonymousfuns;if(t){let e=this;t.forEach(t=>{this.on(t.eventName,this,function(){e[B.bpSymbol].run(e[B.contextSymbol],t,Array.from(arguments),null)})})}}[(B.contextSymbol,B.bpSymbol,B.contextSymbol,B.onChangeSymbol,B.autoRunSymbol)](){this[B.bpSymbol].mainBlock.runAuto(this[B.contextSymbol])}}}[i]);var i,a;return Object.defineProperty(n,"name",{value:t}),n[B.contextSymbol]=new B.BPExecuteCls(n),n._$loadable=!0,n.prototype[B.bpSymbol]=new B.BPRuntimeCls,n}static parseCls(t,e,n,i,a,s,r){var u,o;let l=n[B.contextSymbol];if(s)for(let t in s)(null===(u=s[t].modifiers)||void 0===u?void 0:u.isStatic)&&l.initVar(s[t].name,s[t].value);let p=n.prototype[B.bpSymbol];p.dataMap=i.dataMap;let c=function(t){let e=E.getConstNode(t);return null==e&&r&&t.target&&!r.includes(t.target)&&console.warn(`Missing blueprint data: ${t.target} ${t.cid}`),e};p.varMap=s,p.isRunningInIDE=null===(o=e.globalInfo)||void 0===o?void 0:o.isRunningInIDE,p.parse(i,c,s,n),a.forEach(t=>{p.parseFunction(t,c)}),this.initClassHook(t,n)}static createClsNew(t,e,n,i,a,s){let r=this.createCls(t,n);return this.parseCls(t,e,r,i,a,s,null),r}static initClassHook(t,e){}static onPropertyChanged_EM(t){}static get instance(){return this._instance||(this._instance=new B),this._instance}createNew(e,n){var i;let a=null===(i=e.modifiers)||void 0===i?void 0:i.isAutoRun,s=B._bpMap.get(e.type)||B._bpMap.get(t.BPType.Pure);a&&(s=b);let r=new s;return r.nid=n.id,n.autoReg&&(r.autoReg=n.autoReg),r.parse(e),r._testItem=n,r._testConfig=e,r}}B.bpSymbol=Symbol("bpruntime"),B.contextSymbol=Symbol("context"),B.onChangeSymbol=Symbol("onChange"),B.autoRunSymbol=Symbol("autoRun"),B._funMap=new Map,B._bpMap=new Map,B._bpContextMap=new Map,B.bpNewMap=new Map;class E{static clone(t){return null==t?t:JSON.parse(JSON.stringify(t))}static getConstNode(t){return this.initConstNode(),this.bpData.getConstNode(t)}static getConstDataById(t,e){return this.bpData.getConstDataById(t,e)}static addCustomData(t,e){n[t]=e,E.customModify=!0;for(let e in this.onfinishCallbacks){let[n,i,a]=this.onfinishCallbacks[e],s=a?[t,...a]:[t];n.apply(i,s)}}static getDeclaration(t){return i[t]?i[t]:n[t]}static initConstNode(){null==this.bpData&&(this.bpData=new m(i,B.regFunction.bind(B),E.getClass.bind(E))),this.customModify&&(this.bpData.initData(n),this.customModify=!1)}static getClass(t){return this.classMap[t]}static regClass(t,e){this.classMap[t]=e}static regResByUUID(t,e){this.resouceMap.set(t,e)}static getResByUUID(t){return this.resouceMap.get(t)}static getNameByUUID(t){return null}}E.classMap={},E.onfinishCallbacks={},E.resouceMap=new Map,E.CustomClassFinish="CustomClassFinish",E.customModify=!1;const M={"=":0,"+=":0,"|":0,"||":0,"&":1,"&&":1,"+":2,"-":2,"*":3,"/":3,">=":4,"<=":4,"==":4,"!=":4,">":4,"<":4,"!":5,"++":6,"--":6};class _{call(t){return null}constructor(t){this.value=t,this.left=null,this.right=null}static autoFormat(t){let e;if(_.realMap.hasOwnProperty(t))return _.realMap[t];if(_.isNumber(t))return parseFloat(t);if(e=_.isString(t))return e;try{return JSON.parse(t)}catch(e){return t}}equal(t,e){}static isNumber(t){return!isNaN(t)&&!isNaN(+t)}static isString(t){let e=_.strReg.exec(t);return!!e&&e[2]}static isExpress(t){return/[&|.!+\-*/]/.test(t)}static splitExpress(t){const e=[];let n="",i=0;for(const a of t)"("===a?(i++,n+=a):")"===a?(i--,n+=a):"."===a&&0===i?(e.push(n),n=""):n+=a;return n&&e.push(n),e}clone(){let t=new _(this.value);return this.left&&(t.left=this.left.clone()),this.right&&(t.right=this.right.clone()),t.call=this.call,t}static parseProperty(t){let e;const n=_.splitExpress(t);let i,a=[],s=[];for(const t of n)if(t.includes("(")){let e=t.indexOf("("),n=t.slice(0,e),r=t.slice(e+1,t.length-1).split(",");for(let t=0;t<r.length;t++){let e=r[t];if(_.isNumber(e))s[t]=new v(Number(e));else{let n=_.isString(e);!1===n?this.realMap.hasOwnProperty(e)?s[t]=new v(this.realMap[e]):this.isExpress(e)?s[t]=I.instance.parse(e):s[t]=this.parseProperty(e):s[t]=new D(n)}}a.push(n),i=!0}else a.push(t);return i?(e=new C(a),e.params=s):e=new T(a),e}static creatreExpressTree(t){let e=this.operatorPriority[t];if(null==e){if(this.isNumber(t))e=new v(Number(t));else{let n=this.isString(t);e=!1===n?this.realMap.hasOwnProperty(t)?new v(this.realMap[t]):this.parseProperty(t):new D(n)}return e}return e.clone()}static init(){if(!this._inited){var t=[];for(let e in M){let n=new _(e);switch(t.push(n),e){case"=":n.call=function(t){return this.left.equal(this.right.call(t),t)};break;case"+=":n.call=function(t){return this.left.equal(this.left.call(t)+this.right.call(t),t)};break;case"&":n.call=function(t){return this.left.call(t)&this.right.call(t)};break;case"|":n.call=function(t){return this.left.call(t)|this.right.call(t)};break;case"&&":n.call=function(t){return this.left.call(t)&&this.right.call(t)};break;case"||":n.call=function(t){return this.left.call(t)||this.right.call(t)};break;case"+":n.call=function(t){return this.left.call(t)+this.right.call(t)};break;case"-":n.call=function(t){return this.left.call(t)-this.right.call(t)};break;case"*":n.call=function(t){return this.left.call(t)*this.right.call(t)};break;case"/":n.call=function(t){return this.left.call(t)/this.right.call(t)};break;case">=":n.call=function(t){return this.left.call(t)>=this.right.call(t)};break;case"<=":n.call=function(t){return this.left.call(t)<=this.right.call(t)};break;case"==":n.call=function(t){return this.left.call(t)==this.right.call(t)};break;case"!=":n.call=function(t){return this.left.call(t)!=this.right.call(t)};break;case">":n.call=function(t){return this.left.call(t)>this.right.call(t)};break;case"<":n.call=function(t){return this.left.call(t)<this.right.call(t)};break;case"!":n.call=function(t){return!this.right.call(t)};break;case"++":n.call=function(t){if(this.right)return this.right.equal(this.right.call(t)+1,t);{let e=this.left.call(t);return this.left.equal(e+1,t),e}};break;case"--":n.call=function(t){if(this.right)return this.right.equal(this.right.call(t)-1,t);{let e=this.left.call(t);return this.left.equal(e-1,t),e}}}t.forEach((t,e)=>{this.operatorPriority[t.value]=t})}this._inited=!0}}}_.strReg=new RegExp("^(\"|')(.*)\\1$"),_.realMap={true:!0,false:!1,null:null,undefined:void 0},_.operatorPriority={},_._inited=!1;class v extends _{constructor(t){super(t)}call(t){return this.value}}class D extends _{constructor(t){super(t)}call(t){return this.value}}class T extends _{constructor(t){super(t),this.propertys=t}equal(t,e){return this.realObj?this.realObj[this.realKey]=t:e[this.propertys[0]]=t,t}call(t){let e=t;return this.propertys.forEach((t,n)=>{e?(this.realObj=e,e=e[B.contextSymbol]?e[B.contextSymbol].getVar(t):e[t],this.realKey=t):console.warn(this.propertys,t+"属性不存在")}),e}}class C extends T{call(t){let e=super.call(t);if(!e)return console.warn(this.propertys,"函数不存在"),null;let n=[];return this.params.forEach((e,i)=>{n.push(e.call(t))}),e.apply(this.realObj,n)}}class k extends _{call(t){return this.left.call(t)[this.right.call(t)]}equal(t,e){this.left.call(e)[this.right.call(e)]=t}}class I{constructor(){this._catch=new Map}static get instance(){return this._instance||(_.init(),this._instance=new I),this._instance}isOperator(t){return-1!=Object.keys(M).indexOf(t)}tokenize(t){let e=new RegExp("/\\*([\\s\\S]*?)\\*/|//.*|'(.*?)'|\"(.*?)\"|\\`([\\s\\S]*?)\\`|\\.{3}|[$\\w.]+|(\\+\\+|--|\\|\\||&&|>>>|>>|<<|==|!=)(=){0,1}|=>|\\*\\*(=){0,1}|[+*-/%=><!\\|&~^](=){0,1}|[?;:()\\[\\]{\\}]","g"),n=t.match(e);if(!n)return null;let i=[],a=0,s=t=>!isNaN(t)||this.isOperator(t)||-1!=I.brackets.indexOf(t);for(let t=0;t<n.length;t++){let e=n[t],r=n[t+1];a?(i[i.length-1]+=e,r&&(")"==r?(a--,a||(i[i.length-1]+=r,t++)):"("==r&&a++)):(i.push(e),a=s(e)||"("!=r?0:1)}let r=[];for(let t=0;t<i.length;t++){let e=i[t],n=i[t+1];r.push(e),!n||s(e)||s(n)||(t++,r[r.length-1]+=n)}return r}parse(t){if(this._catch.has(t))return this._catch.get(t);const e=this.tokenize(t),n=[],i=[],a=()=>{const t=n.pop(),e=i.pop(),a=i.pop(),s=_.creatreExpressTree(t);s.left=a,s.right=e,i.push(s)};for(null==e||e.forEach(t=>{if("("===t||"["===t)n.push(t);else if(")"===t||"]"===t){for(;n[n.length-1]!==I.brackmap[t];)a();if("]"==t){const t=new k(null);t.right=i.pop(),t.left=i.pop(),i.push(t)}n.pop()}else if(this.isOperator(t)){for(;n.length&&M[t]<=M[n[n.length-1]];)a();"++"!=t&&"--"!=t||i.push(null),n.push(t)}else i.push(_.creatreExpressTree(t))});n.length;)a();let s=i.pop();return this._catch.set(t,s),s}}I.brackets=["(",")","[","]"],I.brackmap={")":"(","]":"["};class F{static branch(t,e){return e?t[0]:t[1]}static switchFun(t,e){return t.find(t=>t.nid==e)||t.find(t=>"default"==t.nid)}static print(t){console.log(t)}static getTempVar(t,e,n){return e.getVar(t,n)}static setTempVar(t,e,n,i){return n.setVar(e,t,i)}static getVariable(t,e,n){if(t){let n=t[B.contextSymbol];return n?n.getVar(e):t[e]}return n.getVar(e)}static getSelf(t,e){return e.getSelf()}static setVariable(t,e,n,i){if(t){let i=t[B.contextSymbol];i?i.setVar(n,e):t[n]=e}else i.setVar(n,e);return e}static waitTime(t){return new Promise((e,n)=>{setTimeout(()=>{e(!0)},1e3*t)})}static expression(){return!0}static typeInstanceof(t,e,n){let i;return i="string"==typeof n?typeof e==n:e instanceof n,i?t[0]:t[1]}static runBranch(t,e,n,i,a,s,r,u){let o=a.getRunID();n.forEach((t,n)=>{s.setPinData(e[n],t,o)}),s.saveContextData(u,o),a.runByContext(i,s,t.owner,!0,null,o,t,r)}static forEach(t,e,n,i,a,s,r,u,o){let l=n[0].linkTo[0];return l&&o.forEach((t,e)=>{F.runBranch(l,i,[t,e],a,s,r,n[0],u)}),n[1].execute(a,r,s,u)}static forEachWithBreak(t,e,n,i,a,s,r,u,o){let l;if(t==e[1])return l=r.getRuntimePinById(t.id),l.getValue(u)==S.running&&l.initValue(S.break),null;l=r.getRuntimePinById(e[1].id),l.initValue(S.running);let p=n[0].linkTo[0];if(p)for(let t=0;t<o.length&&(F.runBranch(p,i,[o[t],t],a,s,r,n[0],u),l.getValue(u)!=S.break);t++);return l.initValue(S.end),n[1].execute(a,r,s,u)}static forLoop(t,e,n,i,a,s,r,u,o,l,p=1){p<=0&&(p=1);let c=n[0].linkTo[0];if(c)for(let t=o;t<l;t+=p)F.runBranch(c,i,[t],a,s,r,n[0],u);return n[1].execute(a,r,s,u)}static forLoopWithBreak(t,e,n,i,a,s,r,u,o,l,p=1){let c;if(t==e[1])return c=r.getRuntimePinById(t.id),c.getValue(u)==S.running&&c.initValue(S.break),null;{c=r.getRuntimePinById(e[1].id),c.initValue(S.running),p<=0&&(p=1);let t=n[0].linkTo[0];if(t)for(let e=o;e<l&&(F.runBranch(t,i,[e],a,s,r,n[0],u),c.getValue(u)!=S.break);e+=p);return c.initValue(S.end),n[1].execute(a,r,s,u)}}static runExpress(t,e,n,i){let a=I.instance.parse(t),s={a:e,b:n,c:i,Math:Math};return a.call(s)}}var S,w;!function(t){t[t.running=1]="running",t[t.break=2]="break",t[t.end=0]="end"}(S||(S={}));class N extends x{optimize(){let t=this.outPutParmPins[0],e=this.inPutParmPins[0],n=e.linkTo[0];if(n){t.linkTo.forEach(e=>{let i=e.linkTo.indexOf(t);e.linkTo[i]=n;let a=n.linkTo.indexOf(e);-1!=a?n.linkTo[a]=e:n.linkTo.push(e)});let i=n.linkTo.indexOf(e);n.linkTo.splice(i,1)}}}class V extends x{constructor(){super(),this.inExecutes=[],this.outExecutes=[],this.tryExecute=this.emptyExecute}next(t,e,n,i,a,s,r){let u=this.find(this.outExecutes,...n);return u.linkTo.length?u:null}addPin(e){super.addPin(e),e.type==t.EPinType.Exec&&(e.direction==t.EPinDirection.Input?this.inExecutes.push(e):e.direction==t.EPinDirection.Output&&this.outExecutes.push(e))}setFunction(t){this.nativeFun=null,this.funcode=null==t?void 0:t.name,this.find=t}}class R extends V{next(t,e,n,i,a,s,r){return this.deal(r,this.inExecutes,this.outExecutes,this.outPutParmPins,t,i,e,s,...n)}setFunction(t){this.nativeFun=null,this.funcode=null==t?void 0:t.name,this.deal=t}}class O extends x{constructor(){super(),this.tryExecute=this.emptyExecute}onParseLinkData(t,e){t.dataId&&(this.eventName=E.getConstDataById(t.target,String(t.dataId)).name,this.executeFun=this.executeHookFun)}executeHookFun(t,e,n,i,a,s,r){return a.unshift(this.eventName),t.executeFun(this.nativeFun,this.returnValue,e,i,a,s)}executeFun(e,n,i,a,s,r,u){return a&&this.type==t.BPType.Function&&(this.nativeFun=a[this.name]),this.nativeFun?e.executeFun(this.nativeFun,this.returnValue,n,a,s,r):(console.warn(`failed to call '${this.name}'`),null)}next(){return this.staticNext}addPin(e){super.addPin(e),e.type==t.EPinType.Exec&&(e.direction==t.EPinDirection.Input?this.inExecute=e:e.direction==t.EPinDirection.Output&&(this.outExecute=e,this.outExecutes||(this.outExecutes=[]),this.outExecutes.push(e)))}optimize(){this.staticNext=this.outExecute}}class L extends O{constructor(){super(),this.inExecutes=[]}collectParam(t,e,n,i,a,s){this._checkFun();let r=super.collectParam(t,e,this.inPutParmPins,i,a,s);return t.parmFromOutPut(this.outPutParmPins,e,r),r}_checkFun(){if(!this._isCheck&&(this._isCheck=!0,this.bpruntime)){let t=this.bpruntime.funBlockMap.get(this.functionID);t&&t.isStatic?this.isMember=!1:this.staticContext=null}}onParseLinkData(t,e){let n=String(t.dataId);if(n){this.functionID=n,this.isMember=!0;let e=E.getClass(t.target);e&&(this.bpruntime=e.prototype[B.bpSymbol],this.staticContext=e[B.contextSymbol])}}executeFun(t,e,n,i,a,s,r){let u,o,l,p,c;if(this.isMember){if(!i||!i[B.contextSymbol])return null;u=i[B.bpSymbol],o=i[B.contextSymbol]}else u=this.bpruntime,o=this.staticContext;return c=u.runCustomFun(o,this.functionID,a,()=>{this._executeFun(o,p,a,n)},s,this.inExecutes.indexOf(r),this.outExecutes,n,e),!1===c?(l=new Promise((t,e)=>{p=t}),l):null}_executeFun(t,e,n,i){e&&e()}addPin(e){super.addPin(e),e.type==t.EPinType.Exec&&e.direction==t.EPinDirection.Input&&this.inExecutes.push(e)}optimize(){this.staticNext=this.outExecutes[0]}setFunction(t,e){this.nativeFun=this.customFun,this.isMember=e,this.funcode=null==t?void 0:t.name}customFun(t){}}class A extends x{constructor(){super(),this.inExecutes=[]}step(t,e,n,i,a,s,r,u){super.step(t,e,n,i,a,s,r,u);let o=e.getDataById(this.nid),l=this.inExecutes.indexOf(r);if(0!=l)return o.returnResult(s,s),o.runExecute(s,l,t),1;{let t=o.runIdMap.get(s);o.returnResult(s,t)}return null}initData(t,e,n,i,a,s,r,u){t.getDataById(this.nid).initData(e,n,i,a,s,r,u)}addPin(e){super.addPin(e),e.type==t.EPinType.Exec&&e.direction==t.EPinDirection.Input&&this.inExecutes.push(e)}}class U extends a{constructor(){super(),this.returnMap=new Map,this.runIdMap=new Map,this.outExecutesMap=new Map,this.runnerMap=new Map}initData(t,e,n,i,a,s,r){let u=[];this.returnMap.set(t,u),this.runIdMap.set(t,e),this.outExecutesMap.set(t,a),this.runnerMap.set(t,[s,r]);for(let t=i;t<n.length;t++)u.push(n[t])}runExecute(t,e,n){let i=this.outExecutesMap.get(t);if(i){let a=i[e];if(a){let e=a.linkTo[0];if(e){let i=this.runnerMap.get(t);i[0].runByContext(n,i[1],e.owner,!0,null,t,e,a)}}}}returnResult(t,e){let n=this.returnMap.get(t);n&&n.forEach((n,i)=>{n.setValue(e,this.getParamsArray(t)[i])})}}class j extends x{constructor(){super(),this.tryExecute=this.emptyExecute}onParseLinkData(t,e){t.dataId?(this.isAnonymous=!0,this.eventName=E.getConstDataById(t.target,String(t.dataId)).name):this.eventName=t.name}setFunction(t,e){this.nativeFun=null,this.isMember=e,this.funcode=null==t?void 0:t.name}emptyExecute(t,e,n,i,a,s,r){if(r&&"bpFun"==r.otype){let n=e.getDataById(this.nid),a=this;n.eventName=this.eventName;let u=n.getCallFun(s);u||(u=function(){let n=Array.from(arguments);a.outExecute.linkTo[0]&&i.runAnonymous(t,a,n,null,s,0,i.getRunID(),e)},n.setCallFun(s,u)),e.setPinData(r,u,s)}return null}step(t,e,n,i,a,s,r,u){return n&&t.endExecute(this),r||this.staticNext}addPin(e){super.addPin(e),e.type==t.EPinType.Exec&&e.direction==t.EPinDirection.Output&&(this.outExecute=e,this.outExecutes||(this.outExecutes=[]),this.outExecutes.push(e))}optimize(){this.staticNext=this.outExecute}initData(t,e,n){this.outPutParmPins.forEach((i,a)=>{t.setPinData(i,e[a],n)})}}class z extends j{onParseLinkData(t,e){t.dataId?this.eventName=e.dataMap[String(t.dataId)].name:this.eventName=t.name}}class q extends x{constructor(){super()}onParseLinkData(t,e){let n=e.dataMap[String(t.dataId)];this._varKey=n?n.name:E.getConstDataById(t.target,String(t.dataId)).name}step(t,e,n,i,a,s,r,u){let o=this.collectParam(t,e,this.inPutParmPins,i,s,u);if(t.parmFromCustom(o,this._varKey,'"'+this._varKey+'"'),t.parmFromCustom(o,e,"runtimeDataMgr"),t.parmFromCustom(o,s,"runId"),this.nativeFun){let n=t.executeFun(this.nativeFun,this.returnValue,e,F,o,s);null==n&&e.setPinData(this.outPutParmPins[0],n,s)}return null}}class G extends x{constructor(){super()}onParseLinkData(t,e){let n=E.getConstDataById(t.target,String(t.dataId));n&&(this._varKey=n.name)}step(t,e,n,i,a,s,r,u){let o=this.collectParam(t,e,this.inPutParmPins,i,s,u);if(t.parmFromCustom(o,this._varKey,'"'+this._varKey+'"'),t.parmFromCustom(o,t,"context"),this.nativeFun){let n=t.executeFun(this.nativeFun,this.returnValue,e,F,o,s);null==n&&e.setPinData(this.outPutParmPins[0],n,s)}return null}}class K extends x{parse(t){super.parse(t),this.cls=E.getClass(t.target),this.cls||console.warn("regclass not find "+t.target)}step(t,e,n,i,a,s,r,u){let o=this.collectParam(t,e,this.inPutParmPins,i,s,u),l=this.cls?Reflect.construct(this.cls,o):{};if(!this.cls)for(let t=0;t<this.inPutParmPins.length;t++){let e=this.inPutParmPins[t];void 0!==e.value&&(l[e.name]=e.value)}return e.setPinData(this.outPutParmPins[0],l,s),n&&t.endExecute(this),this.next(t,e,o,i,a,s,r)}}class W extends V{next(t,n,i,a,s,r){let u=[];for(let e=0,i=this.outExecutes.length;e<i;e++){let i=this.outExecutes[e],o=i.linkTo[0];if(o){let e,l;if(t.debuggerPause){l=!1;let u=p=>{t.debuggerPause?t.pushBack(p,u):(l=a.runByContext(t,n,p,s,()=>{!1===l&&e&&e()},r,o,i,!0),l&&e&&e())};t.pushBack(o.owner,u)}else l=a.runByContext(t,n,o.owner,s,()=>{!1===l&&e&&e()},r,o,i,!0);if(!1===l){let t=new Promise(t=>{e=t});u.push(t)}}}if(u.length>0){let t=P.create();return Promise.all(u).then(n=>{t.nid=e.NULL_NODE,t.complete(),t.recover()}),t}return null}setFunction(t){}}class $ extends O{constructor(){super()}onParseLinkData(t,e){let n=e.dataMap[String(t.dataId)];this._varKey=n?n.name:E.getConstDataById(t.target,String(t.dataId)).name}step(t,e,n,i,a,s,r,u){let o=this.collectParam(t,e,this.inPutParmPins,i,s,u);return t.parmFromCustom(o,this._varKey,'"'+this._varKey+'"'),t.parmFromCustom(o,e,"runtimeDataMgr"),t.parmFromCustom(o,s,"runId"),this.nativeFun&&t.executeFun(this.nativeFun,this.returnValue,e,O,o,s),this.next()}}class Y extends O{constructor(){super()}onParseLinkData(t,e){let n=e.dataMap[String(t.dataId)];this._varKey=n?n.name:E.getConstDataById(t.target,String(t.dataId)).name}step(t,e,n,i,a,s,r,u){let o=this.collectParam(t,e,this.inPutParmPins,i,s,u);return t.parmFromCustom(o,this._varKey,'"'+this._varKey+'"'),t.parmFromCustom(o,t,"context"),this.nativeFun&&t.executeFun(this.nativeFun,this.returnValue,e,O,o,s),this.next()}}class J{constructor(){this.listNode=[]}}class X extends J{setCacheAble(t,e,n){let i=this._cacheMap.get(t.nid);i||(i=new Map,this._cacheMap.set(t.nid,i)),i.set(e,n)}getCacheAble(t,e){var n;return null===(n=this._cacheMap.get(t.nid))||void 0===n?void 0:n.get(e)}constructor(t){super(),this._cacheMap=new Map,this.vars={},this.owner=t,this.varDefineMap=new Map,this.runtimeDataMgrMap=new Map}finish(t){}getDataManagerByID(t){return this.runtimeDataMgrMap.get(t)}initData(t,e,n,i){let a=this.runtimeDataMgrMap.get(t);if(!a){let s=this.runtimeDataMgrMap.get(i);s?a=s:(a=new H(t),a.initData(e,n)),this.runtimeDataMgrMap.set(t,a)}}pushBack(t,e){}getSelf(){return this.owner}initVar(t,e){this.vars[t]=e,this.varDefineMap.set(t,!0)}setVar(t,e){(this.varDefineMap.get(t)?this.vars:this.owner)[t]=e}getVar(t){return(this.varDefineMap.get(t)?this.vars:this.owner)[t]}getCode(){return""}beginExecute(t,e,n,i,a,s){return-1==this.listNode.indexOf(t)?(this.listNode.push(t),null):null}endExecute(t){}parmFromCustom(t,e,n){t.push(e)}parmFromOtherPin(t,e,n,i,a){i.push(e.getPinData(n,a))}parmFromSelf(t,e,n,i){n.push(e.getPinData(t,i))}parmFromOutPut(t,e,n){for(let i=0,a=t.length;i<a;i++){let a=t[i];n.push(e.getRuntimePinById(a.id))}}executeFun(t,e,n,i,a,s){let r=t.apply(i,a);return e&&n.setPinData(e,r,s),r}reCall(t){}}class H{constructor(t){this.id=t,this.localVarObj={},this.localVarMap=new Map,this.parmsArray=[]}saveContextData(t,e){this.parmsArray.forEach(n=>{n.copyValue(t,e)});let n=this.localVarMap.get(t);n&&this.localVarMap.set(e,Object.create(n))}_initGetVarObj(t){let e=this.localVarMap.get(t);return e||(e=Object.create(this.localVarObj),this.localVarMap.set(t,e)),e}clearVar(t){this.localVarMap.delete(t)}getVar(t,e){return this._initGetVarObj(e)[t]}setVar(t,e,n){return this._initGetVarObj(n)[t]=e}getDataById(t){return this.nodeMap.get(t)}getRuntimePinById(t){return this.pinMap.get(t)}setPinData(t,e,n){this.pinMap.get(t.id).setValue(n,e)}getPinData(t,e){return this.pinMap.get(t.id).getValue(e)}initData(e,n){if(!this.isInit){this.nodeMap||(this.nodeMap=new Map),this.pinMap||(this.pinMap=new Map);let i=this.nodeMap,a=this.pinMap;if(e.forEach((e,n)=>{if(i.get(n))return;let r=new(B.getBPContextData(e.type));i.set(n,r),e.pins.forEach(e=>{let n=new s;n.name=e.name,null!=e.value&&0==e.linkTo.length&&n.initValue(e.value),a.get(e.id),a.set(e.id,n),e.type!=t.EPinType.Exec&&this.parmsArray.push(n)})}),n)for(let t in n)this.localVarObj[n[t].name]=n[t].value;this.isInit=!0}}}class Q{get blockSourceType(){return t.EBlockSource.Unknown}constructor(t){this.id=t,this._maxID=0,this.executeList=[],this.idToIndex=new Map,this.idToIndex.set(e.NULL_NODE,e.MAX_CODELINE),this.nodeMap=new Map,this.poolIds=[],this.anonymousfunMap=new Map,this.anonymousBlockMap=new Map}getDataManagerByID(t){return t.getDataManagerByID(this.id)}get bpId(){return this.name}getNodeById(t){return this.nodeMap.get(t)}_addNode(t,e){return-1==e.indexOf(t)&&(this.idToIndex.set(t.nid,e.length),e.push(t),!0)}optimizeByStart(t,e){let n=[t];for(;n.length>0;){const t=n.pop();this._addNode(t,e)&&t.outExecutes&&(t.optimize(),t.outExecutes.forEach(t=>{t.linkTo&&t.linkTo[0]&&n.push(t.linkTo[0].owner)}))}}clear(){this.executeList.length=0}optimize(){}onParse(t){}append(t,e){this.nodeMap.set(t.nid,t)}getRunID(){return this.poolIds.length>0?this.poolIds.pop():++this._maxID}_recoverRunID(t,e){this.poolIds.push(t),e.clearVar(t)}recoverRunID(t,e){this.hasRefAnony&&(this.poolIds.push(t),e.clearVar(t))}runAnonymous(t,e,n,i,a,s,r,u){let o=this.anonymousBlockMap.get(String(e.nid));return o.haRef&&u.saveContextData(a,r),o.run(t,e,n,i,r,s)}runByContext(t,e,n,i,a,s,r,u,o=!1){-1==s&&(s=this.getRunID());let l=this.idToIndex;const p=l.get(n.nid),c=this.executeList;let h=!0;for(let n=p,o=c.length;n<o;){let o=c[n].step(t,e,!0,this,i,s,r,u);if(i=!0,!(o instanceof g)){if(o instanceof P)return o.wait(n=>{this.runByContext(t,e,n,null!=n.enableDebugPause?n.enableDebugPause:i,a,s,n.pin,n.prePin)}),!1;if(null==o)break;h=!1;break}if(u=o,null==(r=o.linkTo[0]))break;n=l.get(r.owner.nid)}return a&&a(),!o&&h&&(this.recoverRunID(s,e),this.finish(t)),!0}finish(t){}}t.EBlockSource=void 0,(w=t.EBlockSource||(t.EBlockSource={}))[w.Unknown=0]="Unknown",w[w.Main=1]="Main",w[w.Function=2]="Function";class Z extends Q{constructor(){super(...arguments),this.haRef=!1}static findParamPin(e,n,i,a,s){n.get(e.nid)||(n.set(e.nid,e),e.inPutParmPins.forEach(e=>{var r;let u=e.linkTo[0];if(u){let e=u.owner;(null===(r=e.outExecutes)||void 0===r?void 0:r.length)>0?(e.type==t.BPType.Event&&e.isAnonymous&&i.set(e.nid,e),n.has(e.nid)||(-1==a.indexOf(e)&&(s.haRef=!0),n.set(e.nid,e))):Z.findParamPin(e,n,i,a,s)}}))}init(t){this.name=t.eventName||t.name,this.optimizeByStart(t,this.executeList),this.executeList.forEach(t=>{Z.findParamPin(t,this.nodeMap,this.anonymousfunMap,this.executeList,this)})}_checkRef(){for(let t of this.nodeMap.keys()){if(this.nodeMap.get(t).getRef()>1)return!0}return!1}optimizeByBlockMap(t){this.parentId=t.id,this.parent=t;let e=!1;this.anonymousfunMap.forEach(n=>{let i=t.anonymousBlockMap.get(String(n.nid));i.haRef&&(e=!0),this.anonymousBlockMap.set(String(n.nid),i)}),this.hasRefAnony=e}getRunID(){return this.parent.getRunID()}recoverRunID(t,e){this.hasRefAnony||this.parent._recoverRunID(t,e)}run(t,e,n,i,a,s){let r=t.getDataManagerByID(this.parentId);return n&&e.initData(r,n,a),this.runByContext(t,r,e,!0,i,a,e.outExecutes[s],null)}getDataManagerByID(t){return t.getDataManagerByID(this.parentId)}get bpId(){return this.parent.bpId}get blockSourceType(){return this.parent.blockSourceType}finish(t){this.parent.finishChild(t,this)}}class tt extends Q{constructor(t){super(t),this._asList=[],this._pendingClass=new Map,this._eventId=tt.EventId++}initEventBlockMap(t,e){t.forEach(t=>{let n=e.get(String(t.nid));n||(n=new Z(String(t.nid)),e.set(String(t.nid),n)),n.init(t),n.dataMap=this.dataMap,n.optimize()})}optimize(){super.optimize(),this._asList.forEach(t=>{t.optimize()}),this.initEventBlockMap(this.anonymousfunMap,this.anonymousBlockMap),this.anonymousBlockMap.forEach(t=>{t.optimizeByBlockMap(this)})}parse(t,e,n){this.localVarMap=n,this._checkReady(t,e,n)&&(t.forEach(t=>{let n=B.instance.createNew(e(t),t);this.append(n,t)}),t.forEach(t=>{this.getNodeById(t.id).parseLinkData(t,this)}),this.onParse(t),this.optimize())}_onReParse(t,e,n,i){this._pendingClass.get(i)&&this._pendingClass.delete(i),0==this._pendingClass.size&&(delete E.onfinishCallbacks[this._eventId],this.parse(t,e,n))}onEventParse(t){}_checkReady(e,n,i){return e.forEach(e=>{let i=n(e);if(i)i.type==t.BPType.Event&&e.output&&e.output["out_-1"]&&this.onEventParse(i.name);else{let t=e.target;t||console.error("It's old style:"+e.name);let n=this._pendingClass.get(t);n?n.push(e.id):this._pendingClass.set(t,[e.id])}}),!(this._pendingClass.size>0)||(E.onfinishCallbacks[this._eventId]=[this._onReParse,this,[e,n,i]],!1)}append(e,n){switch(super.append(e,n),e.type){case t.BPType.Assertion:this._asList.push(e);break;case t.BPType.Event:n.dataId&&this.anonymousfunMap.set(e.nid,e)}}finishChild(t,e){}}tt.EventId=0;class et extends Z{constructor(){super(...arguments),this.funEnds=[]}init(e){this.funStart=e,super.init(e),this.executeList.forEach(e=>{e.type==t.BPType.CustomFunReturn&&this.funEnds.push(e)})}runFun(t,e,n,i,a,s,r,u,o){let l=this.funStart;if(l){let e=t.getDataManagerByID(this.parentId),p=this.getRunID();return n&&(this.funEnds.forEach(t=>{t.initData(e,p,a,n,l.outPutParmPins.length,r,u,o)}),l.initData(e,n,p)),this.runByContext(t,e,l,!0,i,p,l.outExecutes[s],null)}return null}}class nt extends tt{get bpId(){return this.mainBlock.name}get blockSourceType(){return t.EBlockSource.Function}optimize(){super.optimize(),this.funBlock=new et(this.id),this.funBlock.init(this.funStart),this.funBlock.optimizeByBlockMap(this)}onParse(t){this.funStart=this.getNodeById(t[0].id)}parse(t,e,n){super.parse(t,e,n),this.funStart=this.getNodeById(t[0].id)}run(t,e,n,i,a,s,r,u,o){return t.initData(this.id,this.nodeMap,this.localVarMap),this.funBlock.runFun(t,e,n,i,a,s,r,u,o)}}class it extends tt{constructor(t){super(t),this.eventMap=new Map,this.autoAnonymousfuns=[],this.autoRunNodes=[],this.eventBlockMap=new Map}get bpName(){return E.getNameByUUID(this.name)}get blockSourceType(){return t.EBlockSource.Main}optimize(){super.optimize(),this.initEventBlockMap(this.eventMap,this.eventBlockMap),this.eventBlockMap.forEach(t=>{t.optimizeByBlockMap(this)}),this.anonymousBlockMap.forEach(t=>{this.eventBlockMap.set(t.id,t)});for(let t=0,e=this.autoRunNodes.length;t<e;t++){let n=this.autoRunNodes[t],i=!1;for(let t=0,e=n.outPutParmPins.length;t<e;t++){if(n.outPutParmPins[t].linkTo.length>0){i=!0;break}}i&&(this.autoRunNodes.splice(t,1),t--,e--)}}onEventParse(t){let e=this.cls,n=e.prototype[t],i=this;e.prototype[t]=function(...e){i._onEventParse(t,n,this,...e)}}_onEventParse(...t){const e=t.shift(),n=t.shift(),i=t.shift(),a=i[B.contextSymbol];n&&n.apply(i,t),i[B.bpSymbol].run(a,this.eventMap.get(e),t,null)}append(e,n){switch(super.append(e,n),e.type){case t.BPType.Pure:e instanceof b&&this.autoRunNodes.push(e);break;case t.BPType.Event:n.dataId?n.dataId&&n.autoReg&&this.autoAnonymousfuns.push(e):this.eventMap.set(e.name,e)}}runAuto(t){t.initData(this.id,this.nodeMap,this.localVarMap);let e=this.getRunID();for(let n=0,i=this.autoRunNodes.length;n<i;n++){this.autoRunNodes[n].step(t,t.getDataManagerByID(this.id),!0,this,!0,e,null,null)}}run(t,e,n,i,a,s){return t.initData(this.id,this.nodeMap,this.localVarMap),this.eventBlockMap.get(String(e.nid)).run(t,e,n,i,a,s)}finishChild(t,e){t.finish(e)}}const at=Symbol("mainScope");class st{constructor(){this.isRunningInIDE=!1,this.mainBlock=new it(at),this.funBlockMap=new Map}run(t,e,n,i){this.mainBlock.run(t,e,n,i,this.mainBlock.getRunID(),-1)}runCustomFun(t,e,n,i,a,s,r,u,o){let l=this.funBlockMap.get(e);return l?l.run(t,null,n,i,a,s,r,u,o):null}parse(t,e,n,i){let a=t.arr;this.mainBlock.name=t.name,this.mainBlock.dataMap=this.dataMap,this.mainBlock.cls=i,this.mainBlock.parse(a,e,{})}parseFunction(t,e){var n;let i=String(t.id),a=t.arr,s=new nt(i);s.isStatic=null===(n=t.modifiers)||void 0===n?void 0:n.isStatic,s.mainBlock=this.mainBlock,s.name=t.name,s.dataMap=this.dataMap;let r={};t.variable&&t.variable.forEach(t=>{r[t.name]=t}),s.parse(a,e,r),this.funBlockMap.set(i,s)}toCode(t){}}class rt{static getItem(t,e){return t[e]}static setItem(t,e,n){t[e]=n}push(t){return 0}pop(){return null}splice(t,e){return null}shift(){return null}unshift(t){return null}join(t){return""}concat(t){return null}}rt.prototype.push=Array.prototype.push,rt.prototype.pop=Array.prototype.pop,rt.prototype.splice=Array.prototype.splice,rt.prototype.shift=Array.prototype.shift,rt.prototype.unshift=Array.prototype.unshift,rt.prototype.join=Array.prototype.join,rt.prototype.concat=Array.prototype.concat;var ut=Laya.ClassUtils,ot=Laya.Browser,lt=Laya.URL,pt=Laya.AssetDb;class ct{static __init__(){let t=e.configPath.split("."),n="json"==t[t.length-1];return E.getClass=function(t){return ut.getClass(t)||ot.window.Laya[t]||ot.window.BP[t]},E.regClass=ut.regClass,E.getResByUUID=function(t){return Laya.loader.getRes(lt.getResURLByUUID(t)).create()},E.getNameByUUID=function(t){return pt.inst.uuidMap[t]},Laya.loader.fetch(Laya.PlayerConfig.bpConfigPath||e.configPath,n?"json":"arraybuffer").then(t=>{if(!t)return console.error("Blueprint init fail"),Promise.resolve();let e=t;n||(e=Laya.JsonBinRead.instance.read(t));for(const t in e)i[t]=e[t];return B.BPRuntimeCls=st,B.BPExecuteCls=X,ct.reg(),E.initConstNode(),Laya.URL.overrideExtension(["bp"],"bp.json",!0),Promise.resolve()})}static reg(){const e=B.regBPClass.bind(B);e(t.BPType.Event,j),e(t.BPType.Pure,x),e(t.BPType.Operator,x),e(t.BPType.Function,O),e(t.BPType.GetValue,G),e(t.BPType.SetValue,Y),e(t.BPType.GetTmpValue,q),e(t.BPType.SetTmpValue,$),e(t.BPType.Branch,V),e(t.BPType.Sequence,W),e(t.BPType.NewTarget,K),e(t.BPType.CustomFun,L),e(t.BPType.CustomFunStart,z),e(t.BPType.CustomFunReturn,A),e(t.BPType.Block,R),e(t.BPType.Assertion,N),B.regBPContextData(t.BPType.CustomFunReturn,U);const n=B.regFunction.bind(B);n("equal",function(t,e){return t==e}),n("isNull",function(t){return null==t}),n("toString",function(t){return String(t)}),n("toNumber",function(t){return Number(t)}),n("toBoolean",function(t){return!!t}),n("branch",F.branch),n("forEach",F.forEach),n("forEachWithBreak",F.forEachWithBreak),n("forLoop",F.forLoop),n("forLoopWithBreak",F.forLoopWithBreak),n("event_on",function(t,e){this.on(t,this,e)},!0),n("event_call",function(t,...e){this.event(t,e)},!0),n("event_off",function(t,e){this.off(t,this,e)},!0),n("event_offAll",function(t,e){this.offAll(t)},!0),n("get",F.getVariable),n("static_get",F.getVariable),n("get_self",F.getSelf),n("set",F.setVariable),n("tmp_get",F.getTempVar),n("tmp_set",F.setTempVar),n("static_set",F.setVariable),n("expression",F.expression),n("instanceof",F.typeInstanceof)}}Laya.addInitCallback(ct.__init__);var ht=Laya.Component;class dt{static initDeclaration(t,e){let n="Others";e instanceof Laya.Node?n="Node":e instanceof ht&&(n="Component");let i={name:t,type:n};return dt.bpUserMap.set(e,i),i}static bpClass(t,e){if(e.propertyType&&"class"!=e.propertyType)return console.error("BP:Reg class Fail :",e.name," , propertType is not class!"),null;let n=t.prototype,i=dt.bpUserMap.get(n);return i?i.name=e.name:i=dt.initDeclaration(e.name,n),e.extends&&(i.extends=e.extends),e.canInherited&&(i.canInherited=e.canInherited),e.construct&&(i.construct=e.construct),e.events&&(i.events=e.events),dt.bpUserMap.delete(n),i}static bpProperty(t,e,n){if(n.propertyType&&"property"!=n.propertyType)return void console.error("BP:Reg Property Fail :",e," , propertType is not property!");let i=!!n.modifiers&&!!n.modifiers.isStatic?t.prototype:t,a=dt.bpUserMap.get(i);a||(a=dt.initDeclaration("",i));let s={name:e,type:n.type,caption:n.caption,catalog:n.catalog,modifiers:n.modifiers,tips:n.tips};s.modifiers||(s.modifiers={},s.modifiers.isPublic=!0),a.props||(a.props=[]),a.props.push(s)}static bpFunction(e,n,i,a){var s,r;if(a.propertyType&&"function"!=a.propertyType)return void console.error("BP:Reg Function Fail :",n," , propertType is not function!");let u=!!a.modifiers&&!!a.modifiers.isStatic?e.prototype:e,o=dt.bpUserMap.get(u);o||(o=dt.initDeclaration("",u));let l={name:n,type:a.type||t.BPType.Function,returnType:null!==(s=a.returnType)&&void 0!==s?s:"void",caption:a.caption,catalog:a.catalog,modifiers:a.modifiers,tips:a.tips,params:null!==(r=a.params)&&void 0!==r?r:[]};l.modifiers||(l.modifiers={},l.modifiers.isPublic=!0),o.funcs||(o.funcs=[]),o.funcs.push(l)}static bpAccessor(t,e,n,i){if(i.propertyType&&"property"!=i.propertyType)return void console.error("BP:Reg Accessor Fail :",e," , propertType is not property!");let a=!!i.modifiers&&!!i.modifiers.isStatic?t.prototype:t,s=dt.bpUserMap.get(a);s||(s=dt.initDeclaration("",a));let r={name:e,type:i.type,caption:i.caption,catalog:i.catalog,modifiers:i.modifiers,tips:i.tips};r.modifiers||(r.modifiers={},r.modifiers.isPublic=!0),n.get&&!n.set&&(r.modifiers.isReadonly=!0),s.props||(s.props=[]),s.props.push(r)}static createBPEnum(t,e){let n={name:t,type:"Enum",members:e};E.addCustomData(t,n)}}dt.bpUserMap=new Map;class mt{regBPNode(){}testBPNode(){}constructor(){}}mt.BPMap=new Map;class yt extends Laya.Resource{constructor(t){super(),this._bid=t,this._traceDeps=!0}get cls(){return this._cls}_initTarget(t,e){for(let n=t.length-1;n>=0;n--)null!=t[n].dataId&&null==t[n].target&&(t[n].target=e)}initClass(t){this.data=t,this._cls=null;let e=t.extends,n=E.getClass(e);if(!n)return;this._cls=B.createCls(this._bid,n),Laya.ClassUtils.regClass(this._bid,this.cls);let i=t.blueprintArr,a=this.allNode=[];for(const t in i){let e=i[t];a.push.apply(a,e.arr),this._initTarget(e.arr,this._bid)}let s={};var r=this.varMap={};let u=m.formatData(t,this.name,s,r);this.cls.prototype instanceof Laya.Component&&(u.type="Component"),this.dec=u,E.addCustomData(this._bid,u),this.allData=s,m.allDataMap.set(this._bid,s)}parse(){null!=this.allData&&(B.parseCls(this._bid,this.data,this._cls,{id:0,name:this._bid,dataMap:this.allData,arr:this.allNode},this.data.functions,this.varMap,this.data.preload),this.allNode=null,this.varMap=null)}_disposeResource(){super._disposeResource(),delete Laya.ClassUtils._classMap[this._bid]}}class ft{load(t){return t.loader.fetch(t.url,"json",t.progress.createCallback(.8),t.options).then(e=>{if(!e)return null;if(null==e._$ver)return console.error("Unknow Version!"),null;let n=new yt(t.uuid||t.url);return n.name=Laya.URL.getFileName(t.url),n.initClass(e),n})}postLoad(t,e){if(e.data.preload){let n=Laya.URL.getPath(t.url),i=e.data.preload.map(t=>Laya.Utils.isUUID(t)?"res://"+t:Laya.URL.join(n,t));return t.loader.load(i).then(t=>{e.addDeps(t),e.parse()})}return Promise.resolve()}}Laya.Loader.registerLoader([e.EXT],ft,e.TYPE);t.BPArray=rt,t.BPMathLib=class{static add(t,e){return t+e}static subtract(t,e){return t-e}static multiply(t,e){return t*e}static divide(t,e){if(0===e)throw new Error("不允许除以0。");return t/e}static power(t,e){return Math.pow(t,e)}static sqrt(t){if(t<0)throw new Error("无法计算负数的平方根。");return Math.sqrt(t)}static abs(t){return Math.abs(t)}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static tan(t){return Math.tan(t)}static asin(t){return Math.asin(t)}static acos(t){return Math.acos(t)}static atan(t){return Math.atan(t)}static atan2(t,e){return Math.atan2(t,e)}static distance(t,e,n,i){const a=n-t,s=i-e;return Math.sqrt(a*a+s*s)}static round(t,e){if(e>0){const n=Math.pow(10,e);return Math.round(t*n)/n}return Math.round(t)}static floor(t){return Math.floor(t)}static ceil(t){return Math.ceil(t)}static mod(t,e){return t%e}static min(t,e){return Math.min(t,e)}static max(t,e){return Math.max(t,e)}static random(t,e){return e=null!=e?e:1,(t=null!=t?t:0)+Math.random()*(e-t)}static greater(t,e){return t>e}static less(t,e){return t<e}static equal(t,e){return t===e}static greaterEqual(t,e){return t>=e}static lessEqual(t,e){return t<=e}},t.BPNumber=class{static toFixed(t,e){return t.toFixed(e)}static toExponential(t,e){return t.toExponential(e)}static toPrecision(t,e){return t.toPrecision(e)}static toString(t,e){return t.toString(e)}},t.BPObject=class{static getItem(t,e){return t[e]}static setItem(t,e,n){t[e]=n}static deleteItem(t,e){delete t[e]}},t.BPString=class{static concat(t,e){return t+e}static split(t,e){return t.split(e)}static toUpperCase(t){return t.toUpperCase()}static toLowerCase(t){return t.toLowerCase()}static trim(t){return t.trim()}static trimStart(t){return t.trimStart()}static trimEnd(t){return t.trimEnd()}static includes(t,e,n){return t.includes(e,n)}static startsWith(t,e){return t.startsWith(e)}static endsWith(t,e){return t.endsWith(e)}static replace(t,e,n){return t.replace(e,n)}static indexOf(t,e,n){return t.indexOf(e,n)}static lastIndexOf(t,e,n){return t.lastIndexOf(e,n)}static repeat(t,e){return t.repeat(e)}static charAt(t,e){return t.charAt(e)}static charCodeAt(t,e){return t.charCodeAt(e)}static substring(t,e,n){return t.substring(e,n)}static slice(t,e,n){return t.slice(e,n)}static getLength(t){return t.length}static parseInt(t,e){return parseInt(t,e)}static parseFloat(t){return parseFloat(t)}},t.BluePrintAsNode=N,t.BluePrintBlock=Q,t.BluePrintBlockNode=R,t.BluePrintComplexBlock=tt,t.BluePrintEventBlock=Z,t.BluePrintFunBlock=nt,t.BluePrintFunStartBlock=et,t.BluePrintMainBlock=it,t.BlueprintAutoRun=b,t.BlueprintComplexNode=V,t.BlueprintConst=e,t.BlueprintCreateUtil=ct,t.BlueprintCustomFunNode=L,t.BlueprintCustomFunReturn=A,t.BlueprintCustomFunReturnContext=U,t.BlueprintCustomFunStart=z,t.BlueprintData=m,t.BlueprintDataList=p,t.BlueprintDecorator=dt,t.BlueprintEventNode=j,t.BlueprintExecuteNode=X,t.BlueprintFactory=B,t.BlueprintFunNode=O,t.BlueprintGenCodeNode=class extends J{constructor(){super(...arguments),this.codes=[],this.vars={},this.blockMap=new Map}finish(t){throw new Laya.NotImplementedError}setCacheAble(t,e,n){throw new Laya.NotImplementedError}getCacheAble(t,e){throw new Laya.NotImplementedError}getDataManagerByID(t){throw new Laya.NotImplementedError}initData(t,e){throw new Laya.NotImplementedError}pushBack(t){throw new Laya.NotImplementedError}getSelf(){throw new Laya.NotImplementedError}reCall(t){throw new Laya.NotImplementedError}getVar(t){throw new Laya.NotImplementedError}initVar(t,e){}setVar(t,e){throw new Laya.NotImplementedError}find(t,e){throw new Laya.NotImplementedError}beginExecute(t){let e=this.listNode.indexOf(t);if(-1==e)return this.listNode.push(t),this.currentFun=[],null;{let t="while(true){\n";for(let n=e;n<this.codes.length;n++)t+=this.codes[n].join("\n")+"\n";return t+="}\n",this.blockMap.set(e,{end:this.codes.length-1,code:t}),null}}endExecute(t){this.currentFun&&(this.codes.push(this.currentFun),this.currentFun=null)}parmFromOtherPin(t,e,n,i,a){let s=this.currentFun.pop();s="let "+t.name+t.owner.id+" = "+s,this.currentFun.push(s),i.push(t.name+t.owner.id)}parmFromSelf(t,e,n,i){n.push(t.getValueCode())}parmFromOutPut(t,e,n){}parmFromCustom(t,e,n){t.push(n)}executeFun(t,e,n,i,a,s){let r=t.name+"("+a.join(",")+");";this.currentFun.push(r)}toString(){return"context"}getCode(){let t="";for(let e=0,n=this.codes.length;e<n;e++){let n=this.blockMap.get(e);n?(t+=n.code,e=n.end):t+=this.codes[e].join("\n")+"\n"}return t}},t.BlueprintGetTempVarNode=q,t.BlueprintGetVarNode=G,t.BlueprintLoader=ft,t.BlueprintNewTargetNode=K,t.BlueprintNode=y,t.BlueprintPin=f,t.BlueprintPinRuntime=g,t.BlueprintPromise=P,t.BlueprintResource=yt,t.BlueprintRunBase=J,t.BlueprintRuntime=st,t.BlueprintRuntimeBaseNode=x,t.BlueprintSequenceNode=W,t.BlueprintSetTempVarNode=$,t.BlueprintSetVarNode=Y,t.BlueprintStaticFun=F,t.BlueprintUtil=E,t.EXECID=h,t.ExpressDict=k,t.ExpressFunction=C,t.ExpressOrgin=v,t.ExpressParse=I,t.ExpressProperty=T,t.ExpressString=D,t.ExpressTree=_,t.Precedence=M,t.RuntimeNodeData=a,t.RuntimePinData=s,t.TARGETID=d,t.TestBluePrint=mt,t.bpAccessor=function(t){return function(e,n,i){dt.bpAccessor(e,n,i,t)}},t.bpClass=function(t){return function(e){let n=dt.bpClass(e,t);Laya.ClassUtils._classMap[t.uuid]=e,E.addCustomData(t.uuid,n)}},t.bpFunction=function(t){return function(e,n,i){dt.bpFunction(e,n,i,null!=t?t:{})}},t.bpProperty=function(t){return function(e,n){dt.bpProperty(e,n,t)}},t.createBPEnum=function(t,e){dt.createBPEnum(t,e)},t.customData=n,t.extendsData=i}(window.BP=window.BP||{});